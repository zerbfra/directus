(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bcb707b0"],{"35b9":function(e,t,i){},5843:function(e,t,i){"use strict";var n=i("35b9"),a=i.n(n);a.a},"6ab8":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"interface-many-to-many"},[!1===e.relationshipSetup?i("v-notice",{attrs:{color:"warning",icon:"warning"}},[e._v(" "+e._s(e.$t("relationship_not_setup"))+" ")]):e._e(),null===e.initialValue?i("v-spinner"):[e.items&&e.items.length?i("div",{staticClass:"table"},[i("div",{staticClass:"header"},[i("div",{staticClass:"row"},[e.sortable?i("button",{staticClass:"sort-column",on:{click:e.toggleManualSort}},[i("v-icon",{attrs:{name:"sort",small:"",color:e.manualSortActive?"--action":"--blue-grey-300"}})],1):e._e(),i("div",{staticClass:"preview-col"}),e._l(e.visibleFields,(function(t){return i("button",{key:t.field,attrs:{type:"button"},on:{click:function(i){return e.changeSort(t.field)}}},[e._v(" "+e._s(e.$helpers.formatField(t.field,t.collection))+" "),e.sort.field===t.field?i("v-icon",{attrs:{name:e.sort.asc?"arrow_downward":"arrow_upward",size:16}}):e._e()],1)}))],2)]),i("draggable",{staticClass:"body",class:{dragging:e.dragging,readonly:e.readonly},attrs:{handle:".drag-handle",disabled:!e.sortable||!e.manualSortActive},on:{start:function(t){e.dragging=!0},end:function(t){e.dragging=!1}},model:{value:e.itemsSorted,callback:function(t){e.itemsSorted=t},expression:"itemsSorted"}},e._l(e.itemsSorted,(function(t){return i("div",{key:t[e.junctionRelatedKey][e.relatedPrimaryKeyField],staticClass:"row",on:{click:function(i){return e.startEdit(t[e.junctionPrimaryKey])}}},[e.sortable?i("div",{staticClass:"sort-column",class:{disabled:!e.manualSortActive}},[e.readonly?e._e():i("v-icon",{staticClass:"drag-handle",attrs:{name:"drag_handle"}})],1):e._e(),i("v-ext-display",{staticClass:"preview-col",attrs:{"interface-type":"file",name:"thumbnail",collection:"directus_files",type:"JSON",datatype:"TEXT",value:t[e.junctionRelatedKey]}}),e._l(e.visibleFields,(function(n){return i("div",{key:n.field},[i("v-ext-display",{attrs:{"interface-type":n.interface,name:n.field,type:n.type,collection:n.collection,datatype:n.datatype,options:n.options,value:t[e.junctionRelatedKey][n.field]}})],1)})),e.readonly?e._e():i("button",{staticClass:"remove",on:{click:function(i){return i.stopPropagation(),e.deleteItem(t[e.junctionPrimaryKey])}}},[i("v-icon",{attrs:{name:"close"}})],1)],2)})),0)],1):i("v-notice",[e._v(e._s(e.$t("no_items_selected")))]),e.readonly?e._e():i("div",{staticClass:"buttons"},[e.options.allow_create?i("v-button",{attrs:{type:"button",disabled:e.readonly},on:{click:e.startAddNewItem}},[i("v-icon",{attrs:{name:"add",left:""}}),e._v(" "+e._s(e.$t("add_new"))+" ")],1):e._e(),e.options.allow_select?i("v-button",{attrs:{type:"button",disabled:e.readonly},on:{click:function(t){e.selectExisting=!0}}},[i("v-icon",{attrs:{name:"playlist_add",left:""}}),e._v(" "+e._s(e.$t("select_existing"))+" ")],1):e._e()],1)],e.selectExisting?i("v-item-select",{attrs:{fields:e.visibleFieldNames,collection:e.relation.junction.collection_one.collection,filters:[],value:e.stagedSelection||e.selectionPrimaryKeys},on:{input:e.stageSelection,done:e.closeSelection,cancel:e.cancelSelection}}):e._e(),e.addNew?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{title:e.$t("file_upload"),buttons:{done:{text:e.$t("done")}}},on:{done:function(t){e.addNew=!1},close:function(t){e.addNew=!1}}},[i("div",{staticClass:"upload-modal-body"},[i("v-upload",{attrs:{accept:e.options.accept},on:{upload:e.onFileUpload}})],1)])],1):e._e(),e.editItem?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{title:e.$t("editing_item"),buttons:{save:{text:e.$t("save"),color:"accent"}}},on:{close:e.closeEditItem,save:e.saveEditItem}},[i("div",{staticClass:"edit-modal-body"},[i("v-form",{attrs:{"new-item":"",fields:e.relation.junction.collection_one.fields,collection:e.relation.junction.collection_one.collection,"primary-key":e.editItem[e.junctionRelatedKey]&&e.editItem[e.junctionRelatedKey][e.relatedPrimaryKeyField]||"+",values:e.editItem[e.junctionRelatedKey]},on:{"stage-value":e.stageValue}})],1)])],1):e._e()],2)},a=[],l=(i("99af"),i("4de4"),i("7db0"),i("caad"),i("a15b"),i("d81d"),i("b64b"),i("ac1f"),i("2532"),i("1276"),i("2ca0"),i("498a"),i("2909")),r=(i("96cf"),i("1da1")),o=i("ade3"),c=i("5530"),s=i("8db2"),u=i.n(s),d=i("649d"),f=i("8dee"),m=i.n(f),y=i("2ef0"),p={name:"InterfaceFiles",mixins:[u.a],data:function(){return{sort:{field:null,asc:!0},selectExisting:!1,editItem:!1,addNew:null,dragging:!1,items:null,loading:!1,error:null,stagedSelection:null,initialValue:null}},computed:{relationshipSetup:function(){return!!this.relation},visibleFields:function(){if(!1===this.relationSetup)return[];if(!this.options.fields)return[];var e;Array.isArray(this.options.fields)&&(e=this.options.fields.map((function(e){return e.trim()}))),e=this.options.fields.split(",").map((function(e){return e.trim()}));var t=this.relation.junction.collection_one.fields,i=Object(y["get"])(this.relation,"junction.field_one.field",null);return e.map((function(e){var n=t[e];return i&&e===i&&(n.readonly=!0),n}))},visibleFieldNames:function(){return this.visibleFields.map((function(e){return e.field}))},relatedPrimaryKeyField:function(){return Object(y["find"])(this.relation.junction.collection_one.fields,{primary_key:!0}).field},selectionPrimaryKeys:function(){var e,t=this;return null===(e=this.items)||void 0===e?void 0:e.map((function(e){return e[t.junctionRelatedKey][t.relatedPrimaryKeyField]}))},sortField:function(){var e=this.relation.collection_many.fields,t=Object(y["find"])(e,{type:"sort"});return t},sortable:function(){return!!this.sortField},manualSortActive:function(){return"$manual"===this.sort.field},junctionRelatedKey:function(){return this.relation.junction.field_many.field},junctionPrimaryKey:function(){return Object(y["find"])(this.relation.junction.collection_many.fields,{primary_key:!0}).field},itemsSorted:{get:function(){var e=this;return"$manual"===this.sort.field?Object(y["orderBy"])(Object(y["cloneDeep"])(this.items),(function(t){return t[e.sortField.field]}),this.sort.asc?"asc":"desc"):Object(y["orderBy"])(Object(y["cloneDeep"])(this.items),(function(t){return t[e.junctionRelatedKey][e.sort.field]}),this.sort.asc?"asc":"desc")},set:function(e){var t=this;this.items=e.map((function(e,i){return Object(c["a"])({},e,Object(o["a"])({},t.sortField.field,i+1))}))}}},watch:{items:function(e,t){null===t||Object(y["isEqual"])(e,t)||this.emitValue(e)}},created:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.sortable?e.sort.field="$manual":e.visibleFields&&e.visibleFields.length>0&&(e.sort.field=e.visibleFields[0].field),t.next=3,e.getInitialValue();case 3:e.items=(Object(y["cloneDeep"])(e.initialValue)||[]).filter((function(t){return t[e.junctionRelatedKey]}));case 4:case"end":return t.stop()}}),t)})))()},methods:{getInitialValue:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=[e.junctionPrimaryKey,e.relation.junction_field+".*"],t.next=3,e.$api.getItems(e.relation.collection_many.collection,{fields:i,filter:Object(o["a"])({},e.relation.field_many.field,e.primaryKey)});case 3:n=t.sent,e.initialValue=n.data;case 5:case"end":return t.stop()}}),t)})))()},changeSort:function(e){this.sort.field!==e?(this.sort.asc=!0,this.sort.field=e):this.sort.asc=!this.sort.asc},startAddNewItem:function(){this.addNew=!0},onFileUpload:function(e){var t,i=this.relation.junction.collection_one.fields,n=Object(y["mapValues"])(i,(function(e){return e.default_value})),a="$temp_"+m.a.generate();n.hasOwnProperty(this.relatedPrimaryKeyField)&&delete n[this.relatedPrimaryKeyField],this.items=[].concat(Object(l["a"])(this.items),[(t={},Object(o["a"])(t,this.junctionPrimaryKey,a),Object(o["a"])(t,this.junctionRelatedKey,e.data.data),t)])},stageValue:function(e){var t=e.field,i=e.value;this.$set(this.editItem[this.junctionRelatedKey],t,i)},toggleManualSort:function(){this.sort.field="$manual",this.sort.asc=!0},startEdit:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,a,l,r,o,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(a=Object(y["cloneDeep"])(null===(n=t.items)||void 0===n?void 0:n.find((function(i){return i[t.junctionPrimaryKey]===e}))),l="string"===typeof e&&e.startsWith("$temp_"),!1!==l){i.next=9;break}return r=t.relation.collection_many.collection,i.next=6,t.$api.getItem(r,e,{fields:"*.*.*"});case 6:o=i.sent,c=o.data,a=Object(y["merge"])({},c,a);case 9:t.editItem=a;case 10:case"end":return i.stop()}}),i)})))()},saveEditItem:function(){var e,t=this,i=this.editItem[this.junctionPrimaryKey];this.items=null===(e=this.items)||void 0===e?void 0:e.map((function(e){return e[t.junctionPrimaryKey]===i?t.editItem:e})),this.editItem=null},closeEditItem:function(){this.editItem=null},stageSelection:function(e){this.stagedSelection=e},closeSelection:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var i,n,a,r,c,s,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.stagedSelection||[],e.items=null===(i=e.items)||void 0===i?void 0:i.filter((function(t){var i=t[e.junctionRelatedKey][e.relatedPrimaryKeyField];return a.includes(i)})),r=null===(n=e.items)||void 0===n?void 0:n.map((function(t){return t[e.junctionRelatedKey][e.relatedPrimaryKeyField]})),c=Object(y["difference"])(a,r),t.next=6,e.$api.getItem(e.relation.junction.collection_one.collection,c.join(","),{fields:"*.*.*"});case 6:s=t.sent,u=Array.isArray(s.data)?s.data:[s.data],d=null===u||void 0===u?void 0:u.map((function(t){var i,n="$temp_"+m.a.generate();return i={},Object(o["a"])(i,e.junctionPrimaryKey,n),Object(o["a"])(i,e.junctionRelatedKey,t),i})),e.items=[].concat(Object(l["a"])(e.items),Object(l["a"])(d)),e.stagedSelection=null,e.selectExisting=!1;case 12:case"end":return t.stop()}}),t)})))()},cancelSelection:function(){this.stagedSelection=null,this.selectExisting=null},deleteItem:function(e){var t,i=this;this.items=null===(t=this.items)||void 0===t?void 0:t.filter((function(t){var n=t[i.junctionPrimaryKey];return n!==e}))},emitValue:function(e){var t=this;e=Object(y["cloneDeep"])(e);var i=Object(y["get"])(this.relation,"junction.field_one.field",null),n=e.map((function(e){var n=e[t.junctionPrimaryKey],a=t.initialValue.find((function(e){return e[t.junctionPrimaryKey]===n}));if(a){var l=Object(d["diff"])(a,e);if(Object.keys(l).length>0){var r,c=(r={},Object(o["a"])(r,t.junctionPrimaryKey,n),Object(o["a"])(r,t.junctionRelatedKey,Object(o["a"])({},t.relatedPrimaryKeyField,a[t.junctionRelatedKey][t.relatedPrimaryKeyField])),r);return i&&c[t.junctionRelatedKey].hasOwnProperty(i)&&delete c[t.junctionRelatedKey][i],Object(y["merge"])({},c,l)}return null}return"string"===typeof e[t.junctionPrimaryKey]&&e[t.junctionPrimaryKey].startsWith("$temp_")?Object(o["a"])({},t.junctionRelatedKey,Object(o["a"])({},t.relatedPrimaryKeyField,e[t.junctionRelatedKey][t.relatedPrimaryKeyField])):e})).filter((function(e){return e})),a=this.initialValue.map((function(e){return e[t.junctionPrimaryKey]})),r=e.map((function(e){return e[t.junctionPrimaryKey]})),c=Object(y["difference"])(a,r),s=c.map((function(e){var i;return i={},Object(o["a"])(i,t.junctionPrimaryKey,e),Object(o["a"])(i,"$delete",!0),i}));this.$emit("input",[].concat(Object(l["a"])(n),Object(l["a"])(s)))}}},v=p,h=(i("5843"),i("2877")),b=Object(h["a"])(v,n,a,!1,null,"44362ec7",null);t["default"]=b.exports},"8db2":function(e,t){e.exports={props:{id:{type:String,required:!0},name:{type:String,required:!0},value:{type:null,default:null},type:{type:String,required:!0},length:{type:[String,Number],default:null},readonly:{type:Boolean,default:!1},collection:{type:String,default:null},primaryKey:{type:[Number,String],default:null},required:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},newItem:{type:Boolean,default:!1},relation:{type:Object,default:null},fields:{type:Object,default:null},values:{type:Object,default:null},width:{type:String,default:null,validator(e){return["half","half-left","half-right","full","fill"].includes(e)}}}}}}]);
//# sourceMappingURL=chunk-bcb707b0.3f2d3950.js.map