(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2bf25343"],{"085d":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"interface-many-to-one"},[!1===t.relationSetup?n("div",{staticClass:"notice"},[n("p",[n("v-icon",{attrs:{name:"warning"}}),t._v(" "+t._s(t.$t("interfaces.many-to-many.relation_not_setup"))+" ")],1)]):[n("v-select",{class:{"select-loading":t.loading},attrs:{id:t.name,name:t.name,placeholder:t.options.placeholder||"",options:t.selectOptions,disabled:t.readonly,value:t.valuePK,icon:t.options.icon},on:{input:function(e){return t.$emit("input",e)}}}),!t.readonly&&t.count>t.options.threshold?n("button",{attrs:{type:"button"},on:{click:function(e){t.listingActive=!0}}}):t._e(),n("v-spinner",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"spinner",attrs:{color:"--blue-grey-300","background-color":"--blue-grey-200"}}),t.listingActive?n("v-item-select",{attrs:{collection:t.relation.collection_one.collection,fields:t.relatedFields,filters:[],single:"",value:t.stagedValue||t.valuePK},on:{input:t.stageValue,done:t.closeListing,cancel:t.cancelListing}}):t._e()]],2)},l=[],a=(n("99af"),n("4160"),n("caad"),n("d81d"),n("b64b"),n("d3b7"),n("4d63"),n("ac1f"),n("25f0"),n("2532"),n("3ca3"),n("5319"),n("1276"),n("498a"),n("159b"),n("ddb0"),n("2909")),o=n("3835"),r=n("8db2"),s=n.n(r),c=n("1581"),u=n("2ef0"),d={name:"InterfaceManyToOne",mixins:[s.a],data:function(){return{loading:!1,error:null,items:[],count:null,listingActive:!1,selectionSaving:!1,newSelected:null,stagedValue:null}},computed:{relationSetup:function(){return!!this.relation},relatedPrimaryKeyField:function(){return Object(u["find"])(this.relation.collection_one.fields,{primary_key:!0}).field},valuePK:function(){return Object(u["isObject"])(this.value)?this.value[this.relatedPrimaryKeyField]:this.value},systemLanguage:function(){return this.$i18n.locale.split("-")[0]},relatedFields:function(){var t=this.options.visible_fields;return t&&0!==t.length?t.split(",").map((function(t){return t.trim()})):Object(c["a"])(this.options.template)},selectOptions:function(){var t=this;if(0===this.items.length)return{};var e=this.options.template,n=function(n){if(e.includes(".")){var l=e;return Object.keys(n).forEach((function(t){if(Array.isArray(n[t])){var e=Object(u["findIndex"])(n[t],(function(t){return t.lang==i}));l=l.replace(new RegExp(t,"g"),"".concat(t,".").concat(e))}})),t.$helpers.micromustache.render(l,n)}return t.$helpers.micromustache.render(e,n)},i=(e.split(".")[0].replace("{{",""),this.systemLanguage);return Object(u["mapValues"])(Object(u["keyBy"])(this.items,this.relatedPrimaryKeyField),(function(t){return n(t)}))}},watch:{relation:function(){this.relationSetup&&this.fetchItems()}},created:function(){this.relationSetup&&this.fetchItems()},methods:{stageValue:function(t){this.stagedValue=t},fetchItems:function(){var t=this;if(null!=this.relation){var e=this.relation.collection_one.collection;this.loading=!0;var n={fields:"*.*",meta:"total_count",limit:this.options.threshold};return Promise.all([this.$api.getItems(e,n),this.value?this.$api.getItem(e,this.valuePK,{fields:"*.*",limit:1}):null]).then((function(e){var n=Object(o["a"])(e,2),i=n[0],l=i.meta,r=i.data,s=n[1];t.items=s?[s.data].concat(Object(a["a"])(r)):r,t.loading=!1,t.count=l.total_count})).catch((function(e){console.error(e),t.error=e,t.loading=!1}))}},closeListing:function(){var t=this;this.$emit("input",this.stagedValue);var e=this.relation.collection_one.collection,n={fields:"*.*",limit:1};this.loading=!0,this.$api.getItem(e,this.stagedValue,n).then((function(t){return t.data})).then((function(e){return t.items=[].concat(Object(a["a"])(t.items),[e])})).catch((function(e){console.error(e),t.error=e,t.loading=!1})).finally((function(){return t.loading=!1})),this.stagedValue=null,this.listingActive=!1},cancelListing:function(){this.stagedValue=null,this.listingActive=!1}}},f=d,h=(n("a973"),n("2877")),p=Object(h["a"])(f,i,l,!1,null,"30cf0abb",null);e["default"]=p.exports},"2e6c":function(t,e,n){},"4d63":function(t,e,n){var i=n("83ab"),l=n("da84"),a=n("94ca"),o=n("7156"),r=n("9bf2").f,s=n("241c").f,c=n("44e7"),u=n("ad6d"),d=n("9f7f"),f=n("6eeb"),h=n("d039"),p=n("69f3").set,g=n("2626"),m=n("b622"),v=m("match"),y=l.RegExp,b=y.prototype,O=/a/g,w=/a/g,_=new y(O)!==O,j=d.UNSUPPORTED_Y,S=i&&a("RegExp",!_||j||h((function(){return w[v]=!1,y(O)!=O||y(w)==w||"/a/i"!=y(O,"i")})));if(S){var x=function(t,e){var n,i=this instanceof x,l=c(t),a=void 0===e;if(!i&&l&&t.constructor===x&&a)return t;_?l&&!a&&(t=t.source):t instanceof x&&(a&&(e=u.call(t)),t=t.source),j&&(n=!!e&&e.indexOf("y")>-1,n&&(e=e.replace(/y/g,"")));var r=o(_?new y(t,e):y(t,e),i?this:b,x);return j&&n&&p(r,{sticky:n}),r},P=function(t){t in x||r(x,t,{configurable:!0,get:function(){return y[t]},set:function(e){y[t]=e}})},V=s(y),$=0;while(V.length>$)P(V[$++]);b.constructor=x,x.prototype=b,f(l,"RegExp",x)}g("RegExp")},"8db2":function(t,e){t.exports={props:{id:{type:String,required:!0},name:{type:String,required:!0},value:{type:null,default:null},type:{type:String,required:!0},length:{type:[String,Number],default:null},readonly:{type:Boolean,default:!1},collection:{type:String,default:null},primaryKey:{type:[Number,String],default:null},required:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},newItem:{type:Boolean,default:!1},relation:{type:Object,default:null},fields:{type:Object,default:null},values:{type:Object,default:null},width:{type:String,default:null,validator(t){return["half","half-left","half-right","full","fill"].includes(t)}}}}},a973:function(t,e,n){"use strict";var i=n("2e6c"),l=n.n(i);l.a}}]);
//# sourceMappingURL=chunk-2bf25343.af970cbb.js.map